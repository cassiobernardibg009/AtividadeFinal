<%- include('../cabecalhoPublico') %>

<div class="container">
    <h1>Catálogo de Filmes</h1>
    <p>Explore nossos filmes e veja o que os usuários estão dizendo.</p>
    <br>

    <div class="catalogo-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">
        <% if(filmes.length > 0) { %>
            <% for (let filme of filmes) { %>
                <div class="card" style="border: 1px solid #ddd; padding: 15px; border-radius: 8px; background-color: #fff;">
                    <% if (filme.capa) { %>
                        <img src="<%= filme.capa %>" alt="Capa do filme" style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px;">
                    <% } else { %>
                        <div style="width: 100%; height: 200px; background-color: #eee; display: flex; align-items: center; justify-content: center;">Sem Capa</div>
                    <% } %>

                    <h2><%= filme.titulo %></h2>
                    <p><strong>Categoria:</strong> <%= filme.categoria ? filme.categoria.nome : 'Sem categoria' %></p>
                    <p><strong>Classificação:</strong> <%= filme.classificacao %></p>
                    <p><strong>Lançamento:</strong> <%= new Date(filme.anoLancamento).toLocaleDateString('pt-BR') %></p>

                    <% if (filme.video) { %>
                         <p><a href="<%= filme.video %>" target="_blank" class="btn" style="font-size: 0.8rem;">Ver Trailer</a></p>
                    <% } %>
                    
                    <hr>
                    
                    <h3>Avaliações:</h3>
                    <% if (filme.avaliacoes && filme.avaliacoes.length > 0) { %>
                        <ul style="list-style: none; padding: 0;">
                            <% for (let aval of filme.avaliacoes) { %>
                                <li style="background: #f9f9f9; margin-bottom: 5px; padding: 8px; font-size: 0.9rem;">
                                    <strong><%= aval.usuario ? aval.usuario.nome : 'Anônimo' %></strong> (Nota: <%= aval.nota %>)<br>
                                    "<%= aval.comentario %>"
                                </li>
                            <% } %>
                        </ul>
                    <% } else { %>
                        <p style="font-style: italic; color: #666;">Nenhuma avaliação ainda.</p>
                    <% } %>
                </div>
            <% } %>
        <% } else { %>
            <p>Nenhum filme cadastrado no catálogo.</p>
        <% } %>
    </div>
</div>

<%- include('../rodape') %>